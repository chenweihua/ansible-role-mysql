#!/usr/bin/env bash

set -eu
# set -x
# set -o pipefail

# initialize database
{{ mysql_basedir }}/mysql/bin/mysqld --defaults-file=/etc/my.cnf --basedir={{ mysql_basedir }}/mysql --datadir={{ mysql_datadir }}/ --user=mysql --initialize

# start up database
{{ mysql_basedir }}/mysql/bin/mysqld_safe --defaults-file=/etc/my.cnf &

# # cat initial root password
# cat {{ mysql_datadir }}/error.log | grep password > /tmp/mysql_initial_password

# sleep 5 second to make sure the MySQLd has enough time to started
sleep 5

